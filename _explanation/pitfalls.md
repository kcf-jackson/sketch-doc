---
title: 'Pitfalls'
layout: 'default'
description: 'What are some common pitfalls developing JavaScript applications in R?'
---

Common pitfalls developing JavaScript applications in R
-------------------------------------------------------

The examples below use the following options

    debug = TRUE, rules = basic_rules(), deparsers = basic_deparsers(), asset_tags = basic_tags()

in the `source_r` function call. Under this setting, R functions are not
loaded into the environment.

------------------------------------------------------------------------

#### 1. JavaScript uses 0-based indexing

    x <- Array(1, 2, 3)   # Array is a function provided in JavaScript
    console::log(x[0])

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,eCA9IEFycmF5KDEsIDIsIDMpCmNvbnNvbGUubG9nKHhbMF0pCg==&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>

------------------------------------------------------------------------

#### 2. Undeclared variables are created in the global environment

    f <- function() {
        x <- 3      # Variable used without declaration
        return(x)
    }
    console::log(f())
    console::log(x)        # 'x' shows up in the global!

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,ZiA9IGZ1bmN0aW9uKCkgewogICAgeCA9IDMKICAgIHJldHVybih4KQp9CmNvbnNvbGUubG9nKGYoKSkKY29uc29sZS5sb2coeCkK&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>
While directly accessing and modifying global variables are not uncommon
in JavaScript visualisations - as we will see when we use `p5.js` in the
other articles - it is best to use it only when it is necessary. Here is
how one declares a variable before using it:

    f <- function() {
        declare(x)  # Declare variable. Alternatively, you can combine
        x <- 3      # the two lines using `let(x = 3)`.
        return(x)
    }
    # console::log(x)      # This will throw an error.

------------------------------------------------------------------------

#### 3. `return` in JavaScript function must be explicit

    add <- function(x, y) { 
        x + y           # returns nothing, i.e. undefined
    }  
    console::log(add(3, 4))    # expects nothing

    add2 <- function(x, y) { 
        return(x + y)   # returns x + y
    }
    console::log(add2(3, 4))   # expects 7

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,YWRkID0gZnVuY3Rpb24oeCwgeSkgewogICAgeCArIHkKfQpjb25zb2xlLmxvZyhhZGQoMywgNCkpCmFkZDIgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4oeCArIHkpCn0KY29uc29sZS5sb2coYWRkMigzLCA0KSkK&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>

------------------------------------------------------------------------

#### 4. JavaScript function reads argument by position / order

    first <- function(x, y) { 
        return(x)
    }
    console::log(first(y = 3, x = 1))   # the result is 3, not 1!

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,Zmlyc3QgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4oeCkKfQpjb25zb2xlLmxvZyhmaXJzdCgzLCAxKSkK&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>
Note that since JavaScript does not use named argument, `y = 3` and
`x = 1` are actually interpreted as assignments! Both assignments will
happen before the function `first` is called.

But don’t worry, this won’t be a problem in `sketch` as it will strip
off all the names during the transpilation, i.e. `first(y = 3, x = 1)`
gets transpiled into `first(3, 1)`. The design decision rules out the
use of in-place assignments, but it guards against unintended ones.

------------------------------------------------------------------------

#### 5. JavaScript passes objects by reference (think of `R6` in R)

    x = Array(1, 2, 3)
    y = x
    z = Array(...x)  # make a copy explicitly

    y[0] = 999
    console::log(x)         # x is modified!
    console::log(y)
    console::log(z)

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,eCA9IEFycmF5KDEsIDIsIDMpCnkgPSB4CnogPSBBcnJheSguLi54KQp5WzBdID0gOTk5CmNvbnNvbGUubG9nKHgpCmNvbnNvbGUubG9nKHkpCmNvbnNvbGUubG9nKHopCg==&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>

------------------------------------------------------------------------

#### 6. A browser session has a pre-populated namespace

For example, the variables `document`, `window`, `location`, `var`,
`stop`, `open`, `focus` are taken already. *Avoid assigning values to
these variables!*

The full list can be found with the following code:

    # The object (strictly) named "window" refers to your browser window
    for (b in Object::keys(window)) {
        if (window$hasOwnProperty(b)) console::log(b)
    }

<iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;data:application/javascript;base64,LyoKU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vYmFobXV0b3YvY29uc29sZS1sb2ctZGl2CkxpY2Vuc2U6IE1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTUgR2xlYiBCYWhtdXRvdgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCihmdW5jdGlvbiBpbml0Q29uc29sZUxvZ0RpdigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCgogICAgaWYgKGNvbnNvbGUubG9nLnRvRGl2KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHgpIHsKICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N0cmluZycgPyB4IDogSlNPTi5zdHJpbmdpZnkoeCk7CiAgICB9CgogICAgdmFyIGxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7CiAgICB2YXIgZXJyb3IgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7CiAgICB2YXIgd2FybiA9IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpOwogICAgdmFyIHRhYmxlID0gY29uc29sZS50YWJsZSA/IGNvbnNvbGUudGFibGUuYmluZChjb25zb2xlKSA6IG51bGw7CiAgICB2YXIgaWQgPSAnY29uc29sZS1sb2ctZGl2JzsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRlckVsZW1lbnQoKSB7CiAgICAgICAgdmFyIG91dGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghb3V0ZXIpIHsKICAgICAgICAgICAgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWVsZHNldCcpOwogICAgICAgICAgICBvdXRlci5pZCA9IGlkOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXIuY2xhc3NMaXN0LmFkZChpZCk7CgogICAgICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlOwogICAgICAgIHN0eWxlLndpZHRoID0gJzk1JSc7CiAgICAgICAgLy8gc3R5bGUubWluSGVpZ2h0ID0gJzIwMHB4JzsKICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7CiAgICAgICAgc3R5bGUubWFyZ2luVG9wID0gJzIwcHgnOwogICAgICAgIHN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4JzsgIC8vIE1vZGlmaWVkIChDRkspCiAgICAgICAgc3R5bGUubWFyZ2luTGVmdCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICcxMHB4JzsKICAgICAgICBzdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CiAgICAgICAgc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gJzVweCc7CiAgICAgICAgc3R5bGUucGFkZGluZyA9ICc1cHggMTBweCc7CiAgICAgICAgcmV0dXJuIG91dGVyOwogICAgfQoKICAgIHZhciBsb2dUbyA9IChmdW5jdGlvbiBjcmVhdGVMb2dEaXYoKSB7CgogICAgICAgIHZhciBvdXRlciA9IGNyZWF0ZU91dGVyRWxlbWVudCgpOwoKICAgICAgICB2YXIgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjb25zb2xlIG91dHB1dCcpOwogICAgICAgIHZhciBsZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsZWdlbmQnKTsKICAgICAgICBsZWdlbmQuYXBwZW5kQ2hpbGQoY2FwdGlvbik7CiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTsKCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pZCA9ICdjb25zb2xlLWxvZy10ZXh0JzsKICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChkaXYpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfSgpKTsKCiAgICBmdW5jdGlvbiBwcmludFRvRGl2KCkgewogICAgICAgIHZhciBtc2cgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgLm1hcCh0b1N0cmluZykKICAgICAgICAuam9pbignICcpOwogICAgICAgIHZhciB0ZXh0ID0gbG9nVG8udGV4dENvbnRlbnQ7CiAgICAgICAgbG9nVG8udGV4dENvbnRlbnQgPSB0ZXh0ICsgbXNnICsgJ1xuJzsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2dXaXRoQ29weSgpIHsKICAgICAgICBsb2cuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwcmludFRvRGl2LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgY29uc29sZS5sb2cgPSBsb2dXaXRoQ29weTsKICAgIGNvbnNvbGUubG9nLnRvRGl2ID0gdHJ1ZTsKCiAgICBjb25zb2xlLmVycm9yID0gZnVuY3Rpb24gZXJyb3JXaXRoQ29weSgpIHsKICAgICAgICBlcnJvci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ0VSUk9SOicpOwogICAgICAgIHByaW50VG9EaXYuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9OwoKICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIGxvZ1dhcm5pbmcoKSB7CiAgICAgICAgd2Fybi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ1dBUk5JTkc6Jyk7CiAgICAgICAgcHJpbnRUb0Rpdi5hcHBseShudWxsLCBhcmdzKTsKICAgIH07CgogICAgZnVuY3Rpb24gcHJpbnRUYWJsZShvYmpBcnIsIGtleXMpIHsKCiAgICAgICAgdmFyIG51bUNvbHMgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbGVuID0gb2JqQXJyLmxlbmd0aDsKICAgICAgICB2YXIgJHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAkdGFibGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgJHRhYmxlLnNldEF0dHJpYnV0ZSgnYm9yZGVyJywgJzEnKTsKICAgICAgICB2YXIgJGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgIHZhciAkdGRhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSAnSW5kZXgnOwogICAgICAgICRoZWFkLmFwcGVuZENoaWxkKCR0ZGF0YSk7CgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbnVtQ29sczsgaysrKSB7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBrZXlzW2tdOwogICAgICAgICAgICAkaGVhZC5hcHBlbmRDaGlsZCgkdGRhdGEpOwogICAgICAgIH0KICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGhlYWQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciAkbGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICR0ZGF0YS5pbm5lckhUTUwgPSBpOwogICAgICAgICAgICAkbGluZS5hcHBlbmRDaGlsZCgkdGRhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2xzOyBqKyspIHsKICAgICAgICAgICAgICAgICR0ZGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgICAgICAkdGRhdGEuaW5uZXJIVE1MID0gb2JqQXJyW2ldW2tleXNbal1dOwogICAgICAgICAgICAgICAgJGxpbmUuYXBwZW5kQ2hpbGQoJHRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGFibGUuYXBwZW5kQ2hpbGQoJGxpbmUpOwogICAgICAgIH0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnNvbGUtbG9nLXRleHQnKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoJHRhYmxlKTsKICAgIH0KCiAgICBjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24gbG9nVGFibGUoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0YWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0YWJsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iakFyciA9IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIga2V5czsKCiAgICAgICAgaWYgKHR5cGVvZiBvYmpBcnJbMF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmpBcnJbMF0pOwogICAgICAgIH0KICAgICAgICBwcmludFRhYmxlKG9iakFyciwga2V5cyk7CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBwcmludFRvRGl2KCAnRVhDRVBUSU9OOicsIGVyci5tZXNzYWdlICsgJ1xuICAnICsgZXJyLmZpbGVuYW1lLCBlcnIubGluZW5vICsgJzonICsgZXJyLmNvbG5vKTsKICAgIH0pOwoKfSgpKTsK&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;data:application/javascript;base64,Zm9yIChsZXQgYiBvZiBPYmplY3Qua2V5cyh3aW5kb3cpKSB7CiAgICBpZiAod2luZG93Lmhhc093blByb3BlcnR5KGIpKSBjb25zb2xlLmxvZyhiKQp9Cg==&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;" style="border: none; width: 100%">
</iframe>
